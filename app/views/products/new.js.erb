/* Oh God... See if you can clean this up a little... */

// First, slide the add button up and then remove it.
$("#new-product-button").find("a").attr('disabled', 'true');
$("#new-product-button").slideUp( function(){
	$(this).remove();
});

// At the same time render the form and slide it down
$("#products").append("<%= j render 'form' %>");
$("#photo-input").toggle();
$("#new-product-form").slideDown();

// On the form: -----------------------------------------------

// Bind the "cancel" button:
$("#new-product-cancel").click( function(event){
	event.preventDefault();
	$(this).parent().parent().parent().slideUp( function(){

		$(this).remove();
		$("#products").append("<%= j render 'new_product_btn' %>");
		$("#new-product-button").hide().slideDown();

	});
});

// Disable the submit button until a photo is uploaded
$("#create-product").attr('disabled', 'true');
// And disable buttons on click, to prevent double submissions.
$("#new_product").submit( function(){
	$("#create-product").attr('disabled', 'true');
	$("#new-product-cancel").attr('disabled', 'true');
});

// Photo events: -----------------------------------------------

// Bind the photo events:
$("#photo-preview").click( function(){
	// Trigger file selection
	$photo_upload = $("#photo_photo");
	$photo_upload.trigger('click');
});

$("#photo_photo").on("change", function(){
	// Trigger form submit
	$("#photo-submit").trigger("click");
});

$("#photo-submit").click( function(){
	$icon = $("#photo-upload-info").find("h2").find("span")
	$text = $("#photo-upload-info").find("p")

	$icon.removeClass('glyphicon-upload').addClass('glyphicon-time');
	$text.text('Subiendo foto...');
});
